<agent xmlns="http://jadex.sourceforge.net/jadex" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jadex.sourceforge.net/jadex http://jadex.sourceforge.net/jadex-0.96.xsd" name="tablero" package="rescate.tablero">

  <imports>
    <import>jadex.runtime.*</import>
    <import>jadex.planlib.*</import>
    <import>jadex.adapter.fipa.*</import>
    <import>jadex.util.*</import>

    <import>java.util.logging.*</import>
    <import>java.util.*</import>

    <import>rescate.ontologia.acciones.*</import>
    <import>rescate.ontologia.conceptos.*</import>
    <import>rescate.ontologia.predicados.*</import>
    <import>rescate.tablero.planes.*</import>
  </imports>

  <capabilities>
    <capability name="dfcap" file="jadex.planlib.DF" />
  </capabilities>

  <!-- Creencias -->
  <beliefs>
    <!-- A quien le toca actuar -->
    <belief name="turno" class="int">
      <fact>0</fact>
    </belief>

    <!-- Mapa de juego -->
    <belief name="tablero" class="Tablero">
      <fact>new Tablero()</fact>
    </belief>

    <!-- Fichas de danno disponibles -->
    <belief name="fichasDanno" class="int">
      <fact>24</fact>
    </belief>

    <!-- Puntos de interes disponibles -->
    <belief name="PDI" class="int">
      <fact>18</fact>
    </belief>
	
	<!-- Puntos de interes en el tablero -->
    <belief name="PDITablero" class="int">
      <fact>0</fact>
    </belief>

    <!-- PDI personas disponibles -->
    <belief name="fichasVictima" class="int">
      <fact>12</fact>
    </belief>

    <!-- FPDI falsas alarmas disponibles -->
    <belief name="fichasFalsaAlarma" class="int">
      <fact>6</fact>
    </belief>

    <!-- Primeros auxilios disponibles -->
    <belief name="primerosAuxilios" class="int">
      <fact>3</fact>
    </belief>

    <!-- Materias peligrosas disponibles -->
    <belief name="fichasFuegoHumo" class="int">
      <fact>35</fact>
    </belief>

    <!-- Materias peligrosas disponibles -->
    <belief name="fichasMateriaPeligrosa" class="int">
      <fact>6</fact>
    </belief>

    <!-- Focos de calor disponibles -->
    <belief name="fichasFoco" class="int">
      <fact>24</fact>
    </belief>

    <!-- Personas salvadas -->
    <belief name="salvados" class="int">
      <fact>0</fact>
    </belief>

    <!-- Personas no salvadas -->
    <belief name="victimas" class="int">
      <fact>0</fact>
    </belief>

    <!-- Materias peligrosas disponibles -->
    <belief name="finPartida" class="boolean">
      <fact>false</fact>
    </belief>
	
	   <!-- Materias peligrosas disponibles -->
    <beliefset name="casillas" class="Casilla">
      <fact>null</fact>
    </beliefset>

    <!-- Camion de bomberos -->

    <!-- Ambulancia -->

	<!-- Los jugadores han terminado -->
    <belief name="finTurno" class="boolean">
      <fact>false</fact>
    </belief>
	
	<!-- Victimas Salvadas -->
    <belief name="victimaSalvadas" class="int">
      <fact>0</fact>
    </belief>
	
	<!-- Victimas Muertas -->
    <belief name="victimaMuertas" class="int">
      <fact>0</fact>
    </belief>
	
  </beliefs>

  <!-- Metas -->
  <goals>

    <achievegoalref name="df_register">
      <concrete ref="dfcap.df_register" />
    </achievegoalref>
	
	<performgoal name="quieroColocarPuntos"  retry="true" retrydelay="3000" exclude="never" >
			<contextcondition>
				(($beliefbase.finTurno) &amp;&amp; 
        (($beliefbase.PDITablero) &lt; 3))
			</contextcondition>
	</performgoal>
	
	
  </goals>

  <!-- Planes -->
  <plans>
  
    <!-- Cambia una puerta de cerrada a abierta -->
    <plan name="TableroInicial">
      <body class="TableroInicial" />
      <trigger>
        <messageevent ref="msg_TableroInicial" />
      </trigger>
    </plan>

    <!-- Registrar a un jugador -->
    <plan name="unirJugador_plan">
      <body class="TableroUnirJugadorPlan" />
      <trigger>
        <messageevent ref="Request_Unirse_a_la_partida" />
      </trigger>
    </plan>

    <!-- Empieza la partida creando el tablero -->
    <plan name="empezar_plan">
      <body class="EmpezarPlan" />
      <trigger>
        <!--condicion de inicio -->
      </trigger>
    </plan>

    <!-- Asigna un rol a un jugador -->
    <plan name="asignarRol_plan">
      <body class="AsignarRolPlan" />
      <trigger>
        <messageevent ref="Request_Elegir_rol" />
      </trigger>
    </plan>

    <!-- Mueve un jugador a otra casilla (esto junta el protocolo desplazar y desplazar_llamas) -->
    <plan name="moverJugador_plan">
      <body class="MoverJugadorPlan" />
      <trigger>
        <messageevent ref="Request_Desplazar" />
      </trigger>
    </plan>

    <!-- Cambia una ficha de fuego por humo -->
    <plan name="apagarFuego_plan">
      <body class="ApagarFuegoPlan" />
      <trigger>
        <messageevent ref="Request_Apagar_fuego" />
      </trigger>
    </plan>

    <!-- Retira una ficha de fuego -->
    <plan name="extinguirFuego_plan">
      <body class="ExtinguirFuegoPlan" />
      <trigger>
        <messageevent ref="Request_Extinguir_fuego" />
      </trigger>
    </plan>

    <!-- Retira una ficha de humo -->
    <plan name="extinguirHumo_plan">
      <body class="ExtinguirHumoPlan" />
      <trigger>
        <messageevent ref="Request_Extinguir_humo" />
      </trigger>
    </plan>

    <!-- Comunica la informacion de la habitación en la que ha entrado el bombero -->
    <plan name="informarHabitacion_plan">
      <body class="InformarHabitacionPlan" />
      <trigger>
        <!-- Cuando informa -->
        >
      </trigger>
    </plan>

    <!-- Cambia una puerta de cerrada a abierta -->
    <plan name="abrirPuerta_plan">
      <body class="AbrirPuertaPlan" />
      <trigger>
        <messageevent ref="Request_Abrir_puerta" />
      </trigger>
    </plan>

    <!-- Cambia una puerta de abierta a cerrada -->
    <plan name="cerrarPuerta_plan">
      <body class="CerrarPuertaPlan" />
      <trigger>
        <messageevent ref="Request_Cerrar_puerta" />
      </trigger>
    </plan>

    <!-- Suma un punto de dano a una pared -->
    <plan name="derribarPared_plan">
      <body class="DerribarParedPlan" />
      <trigger>
        <messageevent ref="Request_Derribar_pared" />
      </trigger>
    </plan>

    <!-- Mueve un jugador y una victima -->
    <plan name="trasladarVictima_plan">
      <body class="TrasladarVictimaPlan" />
      <trigger>
        <messageevent ref="Request_Trasladar_victima" />
      </trigger>
    </plan>

    <!-- Mueve un jugador con una materia peligrosa -->
    <plan name="trasladarMateriaPeligrosa_plan">
      <body class="TrasladarMateriaPeligrosaPlan" />
      <trigger>
        <messageevent ref="Request_Trasladar_materia_peligrosa" />
      </trigger>
    </plan>

    <!-- Atiende a un jugador herido -->
    <plan name="atender_plan">
      <body class="AtenderPlan" />
      <trigger>
        <messageevent ref="Request_Atender" />
      </trigger>
    </plan>

    <!-- Identifica un punto de interés -->
    <plan name="identificarPuntoDeInteres_plan">
      <body class="IdentificarPuntoDeInteresPlan" />
      <trigger>
        <messageevent ref="Request_Identificar_materia_peligrosa" />
      </trigger>
    </plan>

    <!-- El jugador se monta en un vehiculo -->
    <plan name="montarEnVehiculo_plan">
      <body class="MontarEnVehiculoPlan" />
      <trigger>
        <messageevent ref="Request_Montar_en_vehiculo" />
      </trigger>
    </plan>

    <!-- Conduce un vehiculo en el que este montado el jugador -->
    <plan name="conducirVehiculo_plan">
      <body class="ConducirVehiculoPlan" />
      <trigger>
        <messageevent ref="Request_Conducir_vehiculo" />
      </trigger>
    </plan>

    <!-- Llama a la ambulancia para que se desplace a la casilla designada -->
    <plan name="desplazarAmbulancia_plan">
      <body class="DesplazarAmbulanciaPlan" />
      <trigger>
        <messageevent ref="Request_Desplazar_ambulancia" />
      </trigger>
    </plan>

    <!-- Cambia el rol del jugador -->
    <plan name="cambiarRol_plan">
      <body class="CambiarRolPlan" />
      <trigger>
        <messageevent ref="Request_Cambiar_rol" />
      </trigger>
    </plan>

    <!-- Usa el canon de agua de la ambulancia -->
    <plan name="usarCanonDeAgua_plan">
      <body class="UsarCanonDeAguaPlan" />
      <trigger>
        <messageevent ref="Request_Usar_canon_de_agua" />
      </trigger>
    </plan>

    <!-- El jefe de bomberos manda a un jugador realizar una accion  -->
    <plan name="mando_plan">
      <body class="MandoPlan" />
      <trigger>
        <messageevent ref="Request_Mando" />
      </trigger>
    </plan>

    <!--  -->
    <plan name="eliminarMateriaPeligrosa_plan">
      <body class="EliminarMateriaPeligrosaPlan" />
      <trigger>
        <messageevent ref="Request_Eliminar_materia_peligrosa" />
      </trigger>
    </plan>
	
	<!--  -->
	<plan name="ColocarPuntosInteres">
      <body class="ColocarPuntosInteres" />
	  <trigger>	<goal ref="quieroColocarPuntos"/> </trigger>
	  
    </plan>

  </plans>

  <!-- Eventos -->
  <events>
      <messageevent name="Request_Unirse_a_la_partida" direction="receive" type="fipa">
        <parameter name="performative" class="String" direction="fixed">
          <value>SFipa.REQUEST</value>
        </parameter>
        <parameter name="language" class="String" direction="fixed">
          <value>SFipa.NUGGETS_XML</value> 
        </parameter>
        <parameter name="content-class" class="Class" direction="fixed">
          <value>UnirsePartidaAccion.class</value>
        </parameter>
      </messageevent>

      <messageevent name="Request_Elegir_rol" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Desplazar" direction="send" type="fipa">
      </messageevent>


      <messageevent name="Request_Apagar_fuego" direction="receive" type="fipa">
        <parameter name="performative" class="String" direction="fixed">
            <value>SFipa.REQUEST</value>
          </parameter>
          <parameter name="language" class="String" direction="fixed">
            <value>SFipa.NUGGETS_XML</value> 
          </parameter>
          <parameter name="content-class" class="Class" direction="fixed">
            <value>ApagarFuegoAccion.class</value>
          </parameter>
      </messageevent>

      <messageevent name="Agree_Apagar_Fuego" direction="send" type="fipa">
        <parameter name="performative" class="String" direction="fixed">
          <value>SFipa.INFORM</value>
        </parameter>
        <parameter name="language" class="String" direction="fixed">
          <value>SFipa.NUGGETS_XML</value> 
        </parameter>
        <parameter name="content-class" class="Class" direction="fixed">
          <value>FuegoApagadoPredicado.class</value>
        </parameter>
      </messageevent>

      <messageevent name="Refuse_Apagar_Fuego" direction="send" type="fipa">
        <parameter name="performative" class="String" direction="fixed">
          <value>SFipa.FAILURE</value>
        </parameter>
        <parameter name="language" class="String" direction="fixed">
          <value>SFipa.NUGGETS_XML</value> 
        </parameter>
        <parameter name="content-class" class="Class" direction="fixed">
          <value>FuegoApagadoPredicado.class</value>
        </parameter>
      </messageevent>

      <messageevent name="Request_Extinguir_fuego" direction="receive" type="fipa">
        <parameter name="performative" class="String" direction="fixed">
            <value>SFipa.REQUEST</value>
          </parameter>
          <parameter name="language" class="String" direction="fixed">
            <value>SFipa.NUGGETS_XML</value> 
          </parameter>
          <parameter name="content-class" class="Class" direction="fixed">
            <value>ExtinguirFuegoAccion.class</value>
          </parameter>
      </messageevent>

      <messageevent name="Agree_Extinguir_Fuego" direction="send" type="fipa">
        <parameter name="performative" class="String" direction="fixed">
          <value>SFipa.INFORM</value>
        </parameter>
        <parameter name="language" class="String" direction="fixed">
          <value>SFipa.NUGGETS_XML</value> 
        </parameter>
        <parameter name="content-class" class="Class" direction="fixed">
          <value>FuegoExtinguidoPredicado.class</value>
        </parameter>
      </messageevent>

      <messageevent name="Refuse_Extinguir_Fuego" direction="send" type="fipa">
        <parameter name="performative" class="String" direction="fixed">
          <value>SFipa.FAILURE</value>
        </parameter>
        <parameter name="language" class="String" direction="fixed">
          <value>SFipa.NUGGETS_XML</value> 
        </parameter>
        <parameter name="content-class" class="Class" direction="fixed">
          <value>FuegoExtinguidoPredicado.class</value>
        </parameter>
      </messageevent>

      <messageevent name="Request_Extinguir_humo" direction="receive" type="fipa">
        <parameter name="performative" class="String" direction="fixed">
            <value>SFipa.REQUEST</value>
          </parameter>
          <parameter name="language" class="String" direction="fixed">
            <value>SFipa.NUGGETS_XML</value> 
          </parameter>
          <parameter name="content-class" class="Class" direction="fixed">
            <value>ExtinguirHumoAccion.class</value>
          </parameter>
      </messageevent>

      <messageevent name="Agree_Extinguir_Humo" direction="send" type="fipa">
        <parameter name="performative" class="String" direction="fixed">
          <value>SFipa.INFORM</value>
        </parameter>
        <parameter name="language" class="String" direction="fixed">
          <value>SFipa.NUGGETS_XML</value> 
        </parameter>
        <parameter name="content-class" class="Class" direction="fixed">
          <value>HumoExtinguidoPredicado.class</value>
        </parameter>
      </messageevent>

      <messageevent name="Refuse_Extinguir_Humo" direction="send" type="fipa">
        <parameter name="performative" class="String" direction="fixed">
          <value>SFipa.FAILURE</value>
        </parameter>
        <parameter name="language" class="String" direction="fixed">
          <value>SFipa.NUGGETS_XML</value> 
        </parameter>
        <parameter name="content-class" class="Class" direction="fixed">
          <value>HumoExtinguidoPredicado.class</value>
        </parameter>
      </messageevent>
      <messageevent name="Request_Abrir_puerta" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Cerrar_puerta" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Derribar_pared" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Trasladar_victima" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Trasladar_materia_peligrosa" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Atender" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Identificar_materia_peligrosa" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Montar_en_vehiculo" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Conducir_vehiculo" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Desplazar_ambulancia" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Cambiar_rol" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Usar_canon_de_agua" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Mando" direction="send" type="fipa">
      </messageevent>
      <messageevent name="Request_Eliminar_materia_peligrosa" direction="send" type="fipa">
      </messageevent>
      <messageevent name="msg_TableroInicial" direction="send" type="fipa">
      </messageevent>
  </events>

  <!-- Propiedades -->
  <properties></properties>

  <!-- Configuracion -->
  <configurations>
    <configuration name="default">

      <goals>
        <initialgoal ref="df_register">
          <parameter ref="description">
            <value>
							SFipa.createAgentDescription(null, SFipa.createServiceDescription("tablero", "agente", "Rescate"))
						</value>
          </parameter>
        </initialgoal>
      </goals>

    </configuration>
  </configurations>
</agent>
